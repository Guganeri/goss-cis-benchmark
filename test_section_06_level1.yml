---
# CIS Ubuntu Linux 16.04 LTS Benchmark v1.1.0
#
# 6.1 System File Permissions
# 6.1.2 Ensure permissions on /etc/passwd are configured (Scored)
# 6.1.3 Ensure permissions on /etc/shadow are configured (Scored)
# 6.1.4 Ensure permissions on /etc/group are configured (Scored)
# 6.1.5 Ensure permissions on /etc/gshadow are configured (Scored)
# 6.1.6 Ensure permissions on /etc/passwd- are configured (Scored)
# 6.1.7 Ensure permissions on /etc/shadow- are configured (Scored)
# 6.1.8 Ensure permissions on /etc/group- are configured (Scored)
# 6.1.9 Ensure permissions on /etc/gshadow- are configured (Scored)
# 6.1.10 Ensure no world writable files exist (Scored)
# 6.1.11 Ensure no unowned files or directories exist (Scored)
# 6.1.12 Ensure no ungrouped files or directories exist (Scored)
# 6.1.13 Audit SUID executables (Not Scored)

file:
  /etc/passwd:
    exists: true
    mode: "0644"
    owner: root
    group: root
  /etc/shadow:
    exists: true
    mode: "0640"
    owner: root
    group: shadow
  /etc/group:
    exists: true
    mode: "0644"
    owner: root
    group: root
  /etc/gshadow:
    exists: true
    mode: "0640"
    owner: root
    group: shadow
  /etc/passwd-:
    exists: true
    mode: "0644"
    owner: root
    group: root
  /etc/gshadow-:
    exists: true
    mode: "0640"
    owner: root
    group: shadow
  /etc/group-:
    exists: true
    mode: "0644"
    owner: root
    group: root
  /etc/gshadow-:
    exists: true
    mode: "0640"
    owner: root
    group: shadow

command:
  df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -type f -perm -0002:
    exit-status: 0
    stderr: []
    timeout: 10000
  df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -nouser:
    exit-status: 0
    stderr: []
    timeout: 10000
  df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -nogroup:
    exit-status: 0
    stderr: []
    timeout: 10000
  df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -type f -perm -4000:
    exit-status: 0
    stdout:
      - "/sbin/mount.cifs"
      - "/usr/bin/pkexec"
      - "/usr/bin/sudo"
      - "/usr/bin/at"
      - "/usr/bin/newgrp"
      - "/usr/bin/newuidmap"
      - "/usr/bin/chsh"
      - "/usr/bin/newgidmap"
      - "/usr/bin/passwd"
      - "/usr/bin/gpasswd"
      - "/usr/bin/chfn"
      - "/usr/lib/eject/dmcrypt-get-device"
      - "/usr/lib/openssh/ssh-keysign"
      - "/usr/lib/policykit-1/polkit-agent-helper-1"
      - "/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic"
      - "/usr/lib/dbus-1.0/dbus-daemon-launch-helper"
      - "/usr/lib/snapd/snap-confine"
      - "/bin/ping"
      - "/bin/ntfs-3g"
      - "/bin/umount"
      - "/bin/fusermount"
      - "/bin/su"
      - "/bin/ping6"

    stderr: []
    timeout: 10000
  df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -type f -perm -2000:
    exit-status: 0
    stdout:
      - /sbin/pam_extrausers_chkpwd
      - /sbin/unix_chkpwd
      - /usr/bin/screen
      - /usr/bin/mlocate
      - /usr/bin/wall
      - /usr/bin/bsd-write
      - /usr/bin/at
      - /usr/bin/chage
      - /usr/bin/expiry
      - /usr/bin/ssh-agent
      - /usr/bin/crontab
      - /usr/lib/x86_64-linux-gnu/utempter/utempter
      - /usr/lib/snapd/snap-confine
    stderr: []
    timeout: 10000
